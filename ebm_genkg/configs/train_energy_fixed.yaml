# Fixed baseline for framework iteration (no hyperparameter search).
# run with:
# python scripts/train_energy.py --config configs/train_energy_fixed.yaml

in_npz: /home/code/3Ddetection/IS-Fusion/GenKG/ebm_genkg/experiments/tmp/trainset.npz
out_ckpt: /home/code/3Ddetection/IS-Fusion/GenKG/ebm_genkg/checkpoints/energy_logreg.json
out_summary: /home/code/3Ddetection/IS-Fusion/GenKG/ebm_genkg/checkpoints/energy_logreg.summary.json
dtype: float32

# split
val_ratio: 0.2
seed: 42
split_by: scene

# training
normalize: true
epochs: 12
batch_size: 32768
lr: 0.05
l2: 1.0e-6

# class imbalance
pos_weight_mode: auto
pos_weight: 1.0

# threshold selection on val
threshold_metric: f2
threshold_grid: "0.10,0.15,0.20,0.25,0.30,0.35,0.40,0.45,0.50,0.55,0.60"
relation_feature_names: "temporal_stability,local_density,support_count,support_unique_dt,support_score_mean,support_abs_dt_mean,support_raw_ratio,support_warp_ratio,temporal_local_interaction,support_density_interaction"

# multitask losses
enable_multitask: true
gain_target_field: cand_cover_gain_greedy
gain_target_clip: 1.0
gain_pos_only: true
dup_neg_only: true
lambda_gain: 0.25
lambda_dup: 0.15
dup_weight_power: 1.0
enable_pairwise_dup: true
lambda_pair_dup: 0.20
pair_rank_margin_eps: 0.05
pair_conflict_dup_min: 0.20
pair_max_samples_per_epoch: 200000
pair_batch_size: 4096
target_recall: 0.82
target_select_metric: f1

# learned correction heads (class / attr)
enable_class_head: true
lambda_cls: 0.30
class_pos_only: true
enable_attr_head: true
lambda_attr: 0.10
attr_pos_only: true

max_train_rows: null
